<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расписание Лицей 22</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* --- Адаптивный базовый шрифт --- */
        html {
            /* Шрифт будет плавно меняться от 12px на маленьких экранах до 16px на больших */
            font-size: clamp(12px, 1.5vw, 16px);
        }

        body {
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
            color: #e2e8f0;
            box-sizing: border-box;
            /* Используем rem для адаптивного отступа */
            padding-top: max(3rem, calc(50vh - 23rem));
        }

        .header-info {
            position: fixed;
            top: 1.5rem;
            left: 3rem;
            right: 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Используем rem для адаптивного шрифта */
            font-size: 2.5rem;
            font-weight: bold;
            color: #cbd5e1;
            z-index: 1000;
        }

        .container-fluid {
            padding-top: 6rem; /* Адаптивный отступ */
            padding-left: 2rem;
            padding-right: 2rem;
        }

        h1.main-title {
            font-weight: bold;
            margin-bottom: 2.2rem !important;
            font-size: 4rem;
        }

        .portrait-view { display: none; }
        .landscape-view { display: block; }
        @media (orientation: portrait) {
            .portrait-view { display: block; }
            .landscape-view { display: none; }
        }

        @media (max-width: 768px) {
            .header-info {
                display: none;
            }
            .container-fluid {
                padding-top: 1rem;
            }
            h1.main-title {
                font-size: 2.5rem; /* Уменьшаем заголовок на мобильных */
            }
        }

        .card {
            background-color: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 3.5rem;
        }
        .card-header h4 {
            margin-bottom: 0;
            font-size: 1.5rem;
        }
        .table {
            --bs-table-bg: transparent;
            --bs-table-striped-bg: rgba(255, 255, 255, 0.03);
            --bs-table-border-color: rgba(255, 255, 255, 0.1);
        }
        .table td, .table th {
            font-size: 1.1rem;
            vertical-align: middle;
        }
        .accordion-item {
            background-color: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .accordion-button { background-color: rgba(15, 23, 42, 0.75); }
        .accordion-button:not(.collapsed) { background-color: #1e293b; }
        .carousel-item .table-responsive {
            max-height: 80vh;
            overflow-y: auto;
        }
        .lesson-num-col, .time-col {
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
        }
        .subject-cell {
            padding-left: 1.5rem !important;
            vertical-align: middle;
        }
        .portrait-view .lesson-num-col { width: 13%; }
        .portrait-view .time-col { width: 27%; }
        .landscape-view .table {
            table-layout: fixed;
            width: 100%;
        }
        .landscape-view .lesson-num-col { width: 5%; }
        .landscape-view .time-col { width: 15%; }
        .logo-container {
            position: fixed;
            bottom: 40px;
            left: 50px;
            z-index: 1000;
        }
        .logo-container img {
            max-width: 300px;
            height: auto;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="header-info">
        <span id="live-time">00:00:00</span>
        <span id="current-date">{{ current_date }}</span>
    </div>

    <div class="container-fluid">
        {% if schedule_for_today and active_day_name %}
            <h1 class="text-center main-title">{{ active_day_name }}</h1>

            <!-- === ВИД ДЛЯ ВЕРТИКАЛЬНОГО ЭКРАНА (СПИСКИ) === -->
            <div class="portrait-view">
                {% if schedule_for_today.portrait_view %}
                    <div class="accordion" id="accordion-portrait">
                        {% for class_name, class_data in schedule_for_today.portrait_view.items() %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-portrait-{{ class_name.replace(' ', '-') }}">
                                        <strong>{{ class_name }}</strong>
                                    </button>
                                </h2>
                                <div id="collapse-portrait-{{ class_name.replace(' ', '-') }}" class="accordion-collapse collapse" data-bs-parent="#accordion-portrait">
                                    <div class="accordion-body p-0">
                                        <table class="table table-striped mb-0">
                                            <thead>
                                                <tr>
                                                    <th class="lesson-num-col">№</th>
                                                    <th class="time-col">Время</th>
                                                    <th class="subject-cell">Предмет</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for lesson in class_data.lessons %}
                                                <tr>
                                                    <td class="lesson-num-col">{{ lesson.урок }}</td>
                                                    <td class="time-col">{{ lesson.время }}</td>
                                                    <td class="subject-cell">{{ lesson.предмет }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-info mt-4">Актуальных занятий сейчас нет.</div>
                {% endif %}
            </div>

            <!-- === ВИД ДЛЯ ГОРИЗОНТАЛЬНОГО ЭКРАНА (КАРУСЕЛЬ) === -->
            <div class="landscape-view">
                {% if schedule_for_today.landscape_view %}
                    <div id="scheduleCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-pause="false" data-bs-interval="{{ carousel_interval * 1000 }}">
                        <div class="carousel-inner">
                            {% for grade_key, grade_data in schedule_for_today.landscape_view.items() %}
                                {% if grade_data and grade_data.schedule_rows %}
                                <div class="carousel-item {% if loop.first %}active{% endif %}">
                                    <div class="card">
                                        <div class="card-header">
                                            <h4>{{ grade_key }}</h4>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-striped mb-0">
                                                    <thead>
                                                        <tr>
                                                            <th class="lesson-num-col">№</th>
                                                            <th class="time-col">Время</th>
                                                            {% for class_name in grade_data.class_names %}
                                                                <th class="subject-cell">{{ class_name }}</th>
                                                            {% endfor %}
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for row in grade_data.schedule_rows %}
                                                        <tr>
                                                            <td class="lesson-num-col">{{ row['урок'] }}</td>
                                                            <td class="time-col">{{ row['время'] }}</td>
                                                            {% for class_name in grade_data.class_names %}
                                                                <td class="subject-cell">{{ row.предметы.get(class_name, '') }}</td>
                                                            {% endfor %}
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-info mt-4">Актуальных занятий сейчас нет.</div>
                {% endif %}

                {% if logo_path %}
                <div class="logo-container">
                    <img src="{{ url_for('static', filename=logo_path) }}" alt="Логотип">
                </div>
                {% endif %}

            </div>
        {% else %}
            <div class="alert alert-warning mt-4" role="alert">
                На сегодня расписания нет или оно не загружено.
            </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- LIVE CLOCK SCRIPT ---
        function updateTime() {
            const timeEl = document.getElementById('live-time');
            if (timeEl) {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                timeEl.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        updateTime();
        setInterval(updateTime, 1000);

        // --- AUTO-REFRESH SCRIPT ---
        setInterval(() => {
            console.log('Выполняется периодическое обновление страницы...');
            window.location.reload(true);
        }, {{ refresh_interval }} * 1000);
    </script>
</body>
</html>

